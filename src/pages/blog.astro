---
import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/global.css';
import BlogPost from '../components/BlogPost.astro';

const pageTitle = "Blog Page ðŸ’»";

// Fetch posts and sort them by publication date (newest first)
const postsArray = Object.values(import.meta.glob('./posts/*.md', { eager: true })) as Post[];
const sortedPosts = postsArray.sort((a, b) => Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate));

// Format the pubDate for display
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}/${month}/${day}`;
}

// Define the expected shape of post frontmatter
interface Post {
    frontmatter: {
        url: string;
        title: string;
        pubDate: string;
        author: string;
        description?: string;  // Optional
        image: {
            url: string;
            alt: string;
        };  // Optional
        tags?: string[];  // Optional
    }
}

// Add error handling
if (!sortedPosts || sortedPosts.length === 0) {
  throw new Error('No posts found in the collection');
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
        <style>
            ul {
                padding: 30px 0 0;
            }
        </style>
	</head>
	<body>
        <BaseLayout pageTitle = {pageTitle}>

        <h1>My Astro Learning Blog</h1>
        <h2>... view interesting articles here!</h2>

        <p>This is where I will post about my journey learning Astro.</p>

        <ul>
            {sortedPosts.map((post: any) => <BlogPost url={post.url} title={post.frontmatter.title} pubDate={formatDate(post.frontmatter.pubDate)} author={post.frontmatter.author} image={post.frontmatter.image} />)}
        </ul>

        </BaseLayout>
        <script>
            import "../scripts/menu.js";
        </script>
    </body>
</html>
