---
import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/global.css';
import { getCollection } from 'astro:content';

const pageTitle = "Blog Page ðŸ’»";

// Fetch posts and sort them by publication date (newest first)
const posts = await getCollection('posts');
const sortedPosts = [...posts].sort((a, b) => 
    b.data.pubDate.getTime() - a.data.pubDate.getTime()
);

// Define the expected shape of post frontmatter
interface PostData {
    url: string;
  title: string;
  pubDate: string;
  author: string;
  description?: string;  // Optional
  image: {
    url: string;
    alt: string;
  };  // Optional
  tags?: string[];  // Optional
}

// Add error handling
if (!sortedPosts || sortedPosts.length === 0) {
  throw new Error('No posts found in the collection');
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
        <style>
            ul {
                padding: 30px 0 0;
            }

            li {
                display: flex;
                justify-content: space-around;
                align-items: center;
                margin-bottom: 30px;
                max-width: 500px;
            }

            li img {
                width: 12.5rem;
            }

            @media screen and (max-width: 640px) {
                li {
                    flex-direction: column;
                    margin-bottom: 50px;
                }

                li img {
                    width: 18.75rem;
                }
            }
        </style>
	</head>
	<body>
        <BaseLayout pageTitle = {pageTitle}>

        <h1>My Astro Learning Blog</h1>
        <h2>... view interesting articles here!</h2>

        <p>This is where I will post about my journey learning Astro.</p>

        <ul>
            {sortedPosts.map((post) => (
                <li>
                    <div class="post-text-container">
                        <a href={post.data.url}>{post.data.title}</a>
                        <p>Published: {post.data.pubDate.toLocaleDateString()}</p>
                        <p>Author: {post.data.author}</p>
                    </div>
                    <div class="post-img-container">
                        <img src={post.data.image.url} alt={post.data.image.alt} />
                    </div>
                </li>
            ))}
        </ul>

        </BaseLayout>
        <script>
            import "../scripts/menu.js";
        </script>
    </body>
</html>
